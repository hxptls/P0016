{% extends 'base.html' %}
{% block title %}占座·挑战{% endblock %}
{% block afterhead %}
    {% if login.login %}
        <script>'use strict';
$(function() {
    for (let x = 0; x < 19; x++) {
        for (let y = 0; y < 19; y++) {
            const div_id = '#classroom-seat-' + x + '-' + y;
            let idiotCount = 0;
            $(div_id).click(function () {
                alert('正在操作……');
                $.getJSON('/choose', {
                    'x': x, 'y': y, 'n': '{{ login.name }}'
                }, function(req) {
                    if (req['status'] === 0) {
                        const the_div = div_id +
                            (req['type'] === 'best' ? '>.best' : '>.soso');
                        const displayString =
                                req['action'] === 'add' ? '被你选了' : '被你删了';
                        $(the_div).html(displayString);
                        alert('操作成功');
                    }
                    else {
                        if (idiotCount < 10) {
                            alert('妈的智障');
                            idiotCount++;
                        }
                        else {
                            // 1st Easter Egg!
                            location.href = 'http://www.moj.gov.cn';
                        }
                    }
                })
            })
        }
    }
});
        </script>
    {% endif %}
{% endblock %}
{% block beforeheadinfo %}
<h1>占座·挑战</h1>
{% if not login.login %}
    <div><a class="btn btn-success btn-lg" href="/login">登录</a></div>
{% endif %}
{% endblock %}
{% block body %}
<div id="classroom-container">
    {% for row in seatmap %}
        <div class="classroom-row">
            {% for seat in row %}
                {% if seat.shadowed %}
                    <div class="classroom-seat-shadowed"></div>
                {% endif %}
                {% if not seat.shadowed %}
                    <div class="classroom-seat"
                         id="classroom-seat-{{ seat.x }}-{{ seat.y }}">
                    X: {{ seat.x }} Y:{{ seat.y }}
                        <div class="best">
                            {{- seat.best -}}
                        </div>
                        <div class="soso">
                            {{- seat.soso -}}
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    {% endfor %}
</div>
    <ul>以下言论的最终解释权……死心吧我这么懒才不会解释呢
    <li>用苹果的小伙伴我对不起你们……我真的不是有意的……一定尽快修复,你们先凑合着借个手机选吧……对不起……</li>
    <li>需要登录另一个账号的话在地址后面加上\login就行了.</li>
    <li>弹出"正在处理"的时候起始并没有在处理,要等到你点了确定才处理.我知道这个很蠢,包括弹框本身也很蠢,之后就改.</li>
    <li>这个网站使用flask作为后端,前端使用和借鉴了bootstrap,对他们表示感谢……并且没脸说这么丑的东西是还用了bootstrap.稍后会改.</li>
    <li>等我把项目传到github上以后在这里贴地址.</li>
    <li>座位分配算法在另一个项目里,同样传到github上再说.</li>
    </ul>
{% endblock %}
